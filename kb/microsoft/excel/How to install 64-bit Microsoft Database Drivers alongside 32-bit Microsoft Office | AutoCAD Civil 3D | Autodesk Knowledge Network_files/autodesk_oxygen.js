"use strict";document.domain="autodesk.com",window.closeOxygen=function(){jQuery.colorbox.close(),"undefined"!=typeof window.PluckApp&&window.PluckApp.initialize()};var userServiceUrl,identifier,mode,stateLess,currentDomain,adskLogout,pluckStage,loadOnce,userData,signIn,signOut,lang;"undefined"==typeof Drupal?(userServiceUrl="http://akn.publisher-staging.autodesk.com",identifier="https://accounts-staging.autodesk.com",mode="mobile",pluckStage="true",signIn="Sign In",signOut="Sign Out",lang="en"):(userServiceUrl=Drupal.settings.autodesk_oxygen.userServiceUrl,identifier=Drupal.settings.autodesk_oxygen.accountsUrl,mode=Drupal.settings.autodesk_oxygen.viewmode,pluckStage=Drupal.settings.pluck.pluckStage,signIn=Drupal.settings.autodesk_oxygen.uiLinks.signIn,signOut=Drupal.settings.autodesk_oxygen.uiLinks.signOut,lang=Drupal.settings.l10n.language),stateLess=!1,currentDomain=window.location.protocol+"//"+window.location.host+"/",adskLogout="/Authentication/LogOut?ReturnToUrl=",loadOnce=!1,jQuery(document).ready(function(){jQuery("body").append('<iframe src="" name="oxygen_loader" id="oxygen_loader" style="width:0px;height:0px;display:none;"></iframe>'),jQuery(".block-autodesk-oxygen-block-oxygen-signon > .block-content").html('<a id="simpleOpenAdskLogin" class="adsk-oxygen-link" style="display:none;"><span>'+signIn+"</span></a> "),jQuery("body").on("click","#simpleOpenAdskLogin",function(a){a.preventDefault(),Auth.authModSimpleLogin()}),jQuery("body").on("click","#signOff",function(a){a.preventDefault(),Auth.authModSimpleLogout()}),Auth.authModImmediateLogin()});var parseQueryString=function(a){var b,c,d,e=(/\?/.test(a)?a.split("?")[1]:a).split("&"),f={};for(c=0,d=e.length;d>c;c++)b=e[c].split("="),f[b[0]]=decodeURIComponent(b[1]);return f},Auth=function(){function a(a){var b=jQuery.Deferred();return jQuery.ajax({url:a.url,type:a.type,data:a.data,crossDomain:a.crossDomain,contentType:a.contentType,dataType:a.dataType,timeout:a.timeout,error:function(a){b.reject(a)},success:function(a){a&&"SUCCESS"===a.MESSAGE?b.resolve(a):b.reject(a)}}),b.promise()}return{authModImmediateLogin:function(){var b=encodeURIComponent(currentDomain+"index_refresh.html"),c="identifier="+identifier+"&returnUrl="+b+"&stateLess="+stateLess+"&pluckCookie=true&oauth=true&mode="+mode,d=a({url:userServiceUrl+"/aknuserservices/user/openid/checkidimmediate",type:"GET",data:c,crossDomain:!0,contentType:"application/json",dataType:"jsonp",timeout:15e3});d.done(function(a){if(a.REDIRECT_URL&&!loadOnce){var b=a.REDIRECT_URL;Auth.loadFrame(b,!0)}})},loadFrame:function(a,b){jQuery("iframe#oxygen_loader").attr("src",a),jQuery("iframe#oxygen_loader").load(function(){loadOnce=b})},authModSimpleLogin:function(){Auth.simpleOpenAdskLogin(currentDomain,userServiceUrl,identifier,!0,stateLess,!0,mode).done(function(a){"SUCCESS"===a.MESSAGE&&a.CONSUMER_RESPONSE_DATA?window.closeOxygen():Auth.createLogin(a.REDIRECT_URL,mode)})},authModSimpleLogout:function(){Auth.signOff(!0,userServiceUrl,identifier,adskLogout,!0).done(function(){"undefined"!=typeof GPSEntitlement&&GPSEntitlement.refreshEntitlements(userData)})},simpleOpenAdskLogin:function(b,c,d,e,f,g,h){var i=encodeURIComponent(b+"index_refresh.html"),j="identifier="+d+"&pluckCookie="+e+"&returnUrl="+i+"&stateLess="+f+"&oauth="+g+"&mode="+h+"&lang="+lang;return a({url:c+"/aknuserservices/user/openid/signin",type:"GET",data:j,crossDomain:!0,contentType:"application/json",dataType:"jsonp",timeout:15e3})},immediateLogin:function(b,c,d,e,f,g,h){var i=encodeURIComponent(b+"index_refresh.html"),j="identifier="+d+"&returnUrl="+i+"&stateLess="+f+"&pluckCookie="+e+"&oauth="+g+"&mode="+h;return a({url:c+"/aknuserservices/user/openid/checkidimmediate",type:"GET",data:j,crossDomain:!0,contentType:"application/json",dataType:"jsonp",timeout:15e3})},signOff:function(b,c,d,e,f){var g=encodeURIComponent(currentDomain+"index_refresh.html"),h=identifier+e+g;Auth.loadFrame(h,!1),jQuery(".block-autodesk-oxygen-block-oxygen-signon > .block-content").html('<a id="simpleOpenAdskLogin" class="adsk-oxygen-link"><span>'+signIn+"<span></a> "),removeAnalyticsUser();var i="pluckCookie="+b+"&userid=&oauth="+f;return a({url:c+"/aknuserservices/user/openid/signoff",type:"GET",data:i,crossDomain:!0,contentType:"application/json",dataType:"jsonp",timeout:15e3})},getProductEntitlementData:function(b){return a({url:b+"/aknuserservices/user/entitlement/getentitlementproductdata",type:"GET",data:"",crossDomain:!0,contentType:"application/json",dataType:"jsonp",timeout:15e3})},getRegionalPhoneNumbers:function(b,c){return a({url:b+"/aknuserservices/user/gps/getphoneinfo",type:"GET",data:{countrycode:c},crossDomain:!0,contentType:"application/json",dataType:"jsonp",timeout:15e3})},createLogin:function(a,b){var c=!0;jQuery.colorbox("mobile"===b&&c===!1?{iframe:!0,href:a,maxWidth:"100%",maxHeight:"100%",innerWidth:"100%",innerHeight:"100%",opacity:.45,transition:"none"}:{iframe:!0,href:a,innerWidth:350,innerHeight:400,opacity:.45})},processOpenIDResponse:function(a){userData=parseQueryString(a),"undefined"!=typeof userData.userid?(setAnalyticsUser(userData.userid),jQuery(".block-autodesk-oxygen-block-oxygen-signon > .block-content").html('<a id="signOff" class="adsk-oxygen-link active"><span>'+signOut+"</span></a>"),jQuery(".signIn").css("display","none")):(userData={loginNeeded:"true"},jQuery(".adsk-oxygen-link").css("display",""),jQuery(".signIn").css("display","")),closeOxygen(),"undefined"!=typeof GPSEntitlement&&GPSEntitlement.refreshEntitlements(userData),"undefined"!=typeof autodesk_oxgen_akn_callback&&autodesk_oxgen_akn_callback()}}}();